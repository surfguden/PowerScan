<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>CETONI SDK: CETONI SDK for SiLA 2</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="HeaderLogo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">CETONI SDK
   &#160;<span id="projectnumber">20210607</span>
   </div>
   <div id="projectbrief">The software libraries for integration of all CETONI devices.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Table&#160;of&#160;contents</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('QmixSDK_SiLA.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">CETONI SDK for SiLA 2 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="sila_logo.png" alt="sila_logo.png"/>
</div>
<h1><a class="anchor" id="section_sila2"></a>
SiLA 2 Introduction</h1>
<p><b>SiLA</b> stands for <b>Standardization in Lab Automation</b>. The mission of SiLA is to create an international, open connectivity standard in lab automation. It is is a communication standard for laboratory instruments, such as readers, liquid handling robots, chromatography and other analytical equipment. You can find more information about SiLA on the <a href="https://sila-standard.com">official SiLA website</a> or in this interesting <a href="https://medium.com/@matthieu.croissant/sila-2-hands-on-bringing-automation-to-the-laboratory-dacc12df7152">blog post</a> about SiLA.</p>
<p>The CETONI SiLA 2 drivers can be found in the <b>sila</b> directory of this SDK. These SiLA 2 drivers are based on the <a class="el" href="QmixSDK_Python.html">CETONI SDK for Python</a> in order to control the devices.</p>
<p>The following types of devices are currently supported by the CETONI SiLA2 drivers:</p>
<table  style="border: none">
<tr>
<td style="padding-bottom: 20px"><div class="image">
<img src="cetoni_syringe_pumps.jpg"  align="left"/>
</div>
 </td><td style="padding-left: 20px"><a href="https://www.cetoni.com/products/pumps/">CETONI Nemesys Syringe Pumps</a>  </td></tr>
<tr>
<td style="padding-bottom: 20px"><div class="image">
<img src="cetoni_tubing_pump.jpg"  align="left"/>
</div>
 </td><td style="padding-left: 20px"><a href="https://www.cetoni.com/products/pumps/">CETONI Nemesys Tubing Pumps</a>  </td></tr>
<tr>
<td style="padding-bottom: 20px"><div class="image">
<img src="cetoni_syringe_stirrer.jpg"  align="left"/>
</div>
 </td><td style="padding-left: 20px"><a href="https://www.cetoni.com/products/stirring-systems/">CETONI Stirring Systems</a>  </td></tr>
<tr>
<td style="padding-bottom: 20px"><div class="image">
<img src="cetoni_valves.jpg"  align="left"/>
</div>
 </td><td style="padding-left: 20px"><a href="https://www.cetoni.com/products/valve-modules/">CETONI Valves</a>  </td></tr>
<tr>
<td style="padding-bottom: 20px"><div class="image">
<img src="cetoni_reaction_modules.jpg"  align="left"/>
</div>
 </td><td style="padding-left: 20px"><a href="https://www.cetoni.com/products/tempering-modules/">CETONI Reaction Modules</a>  </td></tr>
<tr>
<td style="padding-bottom: 20px"><div class="image">
<img src="cetoni_io_modules.jpg"  align="left"/>
</div>
 </td><td style="padding-left: 20px"><a href="https://www.cetoni.com/products/io-modules/">CETONI I/O Modules</a>  </td></tr>
<tr>
<td style="padding-bottom: 20px"><div class="image">
<img src="cetoni_sample_handlers.jpg"  align="left"/>
</div>
 </td><td style="padding-left: 20px"><a href="https://www.cetoni.com/products/sample-handling/">CETONI Sample Handlers</a>  </td></tr>
<tr>
<td style="padding-bottom: 20px"><div class="image">
<img src="cetoni_positioning_systems.jpg"  align="left"/>
</div>
 </td><td style="padding-left: 20px"><a href="https://www.cetoni.com/products/positioning-systems/">CETONI Positioning Systsms</a>  </td></tr>
</table>
<h1><a class="anchor" id="section_sila_installation"></a>
Installation</h1>
<dl class="section note"><dt>Note</dt><dd>These SiLA 2 drivers were developed and tested under Windows and Linux (Ubuntu 19.04 and Raspbian Buster on a Raspi 3B+) and are therefore expected to work on these systems. Other operating system should work as well, but have not been tested yet!</dd></dl>
<h2><a class="anchor" id="section_sila_python_dependencies"></a>
Installing Python dependencies</h2>
<p>Install the requirements for the CETONI SiLA drivers from PyPI with</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ pip install -r requirements.txt</div>
</div><!-- fragment --><p>It is recommended to install these things in a virtual environment to not interfere with anything in your system's environment. This will install all Python dependencies for CETONI SiLA drivers most notably <code>sila_python</code> and its codegenerator (<code>sila2codegenerator</code>).</p>
<h2><a class="anchor" id="section_sila_qmix_sdk"></a>
Installing CETONI SDK</h2>
<p>Additionally you'll of course need the CETONI SDK with the Python Integration.</p>
<p>For instructions on how to install the CETONI SDK for Python on your system and get a valid device configuration for your devices see the <a href="https://www.cetoni.de/fileadmin/user_upload/Documents/Manuals/QmixSDK/index.html">CETONI SDK Documentation</a>. On Linux be sure to also install the correct SocketCAN driver (either <a href="https://www.systec-electronic.com/en/company/support/device-driver/">SysTec</a> or <a href="https://www.ixxat.com/support/file-and-documents-download/drivers/socketcan-driver">IXXAT</a> depending on your CETONI base module).</p>
<h1><a class="anchor" id="section_sila_running"></a>
Running SiLA 2 servers</h1>
<dl class="section note"><dt>Note</dt><dd>You always need a valid device configuration created with the <a href="https://www.cetoni.com/products/qmixelements/">CETONI Elements software</a> in order to use SiLA driver. Read the <a href="https://www.cetoni.de/fileadmin/user_upload/Documents/Manuals/QmixSDK/GettingStarted.html">Getting Started</a> section of the CETONI SDK documentation to learn how to create a device configuration.</dd></dl>
<p>Running any valid device configuration to get the corresponding SiLA 2 servers is always done through the <code>sila_qmix.py</code> wrapper script located in the root of this repository.</p>
<h2><a class="anchor" id="section_sila_running_windows"></a>
Windows</h2>
<p>On Windows you can simply run the script through Python giving it the path to the Qmix configuration folder as its argument: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&gt; python .\sila_qmix.py &lt;path\to\your\qmix_config&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="section_sila_running_linux"></a>
Linux</h2>
<p>On Linux this is not as easy, unfortunately. This is due to how Python loads shared object files. You need to specify the dynamic library search path <em>before</em> running the <code>python</code> executable in order for the CETONI SDK to find all necessary libraries. This can be done by manually specifying the <code>PATH</code>, <code>PYTHONPATH</code> and <code>LD_LIBRARY_PATH</code> environment variables before running <code>sila_qmix.py</code>. To make this a bit easier you can use the provided shell script <code>sila_qmix.sh</code>. You only need to edit the path to the CETONI SDK installation folder in this file. After that you can run this script giving it only the path to your configuration folder as its argument:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ ./sila_qmix.sh &lt;path/to/your/qmix_config&gt;</div>
</div><!-- fragment --><p>The script will set the necessary variables and run the python script for you.</p>
<p>You can play around with the server's and their features by using the freely available <a href="https://unitelabs.ch/technology/plug-and-play/sila-browser/">SiLA Browser</a>, for example. Or you can also write your own SiLA Client software using the Python or any other of the <a href="https://gitlab.com/SiLA2/">reference implementations</a> of SiLA 2.</p>
<h1><a class="anchor" id="section_sila_modifying"></a>
Modifying the drivers</h1>
<p>You are of course free to play around with the code inside this repository. Especially when modifying the feature definitions you need to bear in mind a few things. The following is meant to be some kind of guidance for your first steps modifying the code.</p>
<h2><a class="anchor" id="section_sila_repo_layout"></a>
Repository layout</h2>
<p>The repository is structured in the following way:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;sila_qmix</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;|- features/de/cetoni/        # folder structure according to SiLA 2 Part A</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;|  |- controllers/            # contains all feature definitions grouped by category</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;|  |  `- ControlLoopService.sila.xml</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;|  |- core/</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;|  `- ...</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;|- impl/</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;|  |- common/                 # common functionality required by all feature implementations</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;|  `- de/cetoni/              # folder structure as in features/ (above)</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;|     |- controllers/         # contains all feature implementations grouped by category</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;|     |  |- gRPC/             # contains the gRPC generated code (must not be edited!)</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;|     |  |- ControlLoopService_servicer.py    # serves as a bridge between the server and the actual implementations</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;|     |  |- ControlLoopService_real.py        # the real implementation of this feature</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;|     |  |- ControlLoopService_simulation.py  # the simulated implementation of this feature</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;|     |  `- ...</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;|     |- core/</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;|     `- ...</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;|- serv/                            # contains server and client implementations of all services</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;|  |- controllers/</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;|  |  |- QmixControl_server.py      # server implementation of the QmixControl service</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;|  |  |- QmixControl_client.py      # client implementation of the QmixControl service</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;|  |  `- service_description.json   # service description defines the features to use for this service</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;|  |- io/</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;|  `- ...</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;|- templates/                       # template files for developing new features</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;|  |- Feature.sila.xml              # FDL template file</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;|  `- service_description.json      # service description template</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;|- sila_qmix.py                     # standalone python wrapper script to run arbitrary servers</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;`- sila_qmix.sh                     # standalone shell wrapper script for Linux</div>
</div><!-- fragment --><h2><a class="anchor" id="section_sila_code_generation"></a>
Generate the prototype code from the FDL</h2>
<p>If you modify a feature definition (<code>.sila.xml</code> file) you need to regenerate the gRPC Python code and the SiLA implementation prototypes. This is done using the <code>sila2codegenerator</code> from the <code>sila_python</code> reference implementation. The code generator has been automatically installed if you followed the step in <a href="#installation">Installation</a>.</p>
<p>To show you the code generation process we're going to use the <code>PumpFluidDosingService</code> syringe pump feature as an example. In this case the feature definition resides in the file <code>sila_qmix/features/de/cetoni/pumps/syringepumps/PumpFluidDosingService.sila.xml</code>. Let's say you've added anew command to this feature. The code regeneration process is now as follows:</p>
<ol type="1">
<li>Our target directory is the <code>serv/pumps/syringepumps/</code> folder. This folder already contains the <code>service_description.json</code> file that tells the code generator which feature we want our syringe pump server to have. If you added a new feature you need to add it to the <code>SiLA_feature_list</code> in the service description.</li>
<li><p class="startli">Then run the code generator from the root directory (i.e. <code>sila_qmix/</code>) with the following command </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ silacodegenerator -b -o &lt;target_dir&gt; --service-description ../&lt;target_dir&gt;/service_description features/</div>
</div><!-- fragment --><p class="startli">E.g. to generate the code for the 'pumps/syringepumps' category you'd need to run </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ silacodegenerator -b -o serv/pumps/syringepumps --service-description ../serv/pumps/syringepumps/service_description features/</div>
</div><!-- fragment --></li>
<li>This will create the folders with prototype implementations for each feature. You'll also be asked if you want to overwrite the existing <code>_server.py</code> and <code>_client.py</code> files. Answer this with <code>n</code>.</li>
<li>After that delete all directories you don't need and only move the <code>gRPC/</code> directory of th current feature into the correct directory in <code>impl/de/cetoni/</code> (i.e. in our case into <code>impl/de/cetoni/pumps/syringepumps/PumpFluidDosingService/</code>).</li>
<li>Finally, inspect each of the <code>_servicer.py</code>, <code>_real.py</code> and <code>_simulation.py</code> files of te feature to find the prototype definition(s) of the functions for your new command and copy them into the correct file in the <code>impl/</code> folder. Then simply add your implementation in the <code>_real.py</code> file (the <code>_simulation.py</code> files have not been implemented because Qmix configurations support simulated devices already hence we don't need to use the simulation functionality of <code>sila_python</code>). </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Jun 23 2021 07:50:34 for CETONI SDK by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>CETONI SDK: Pump Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="HeaderLogo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">CETONI SDK
   &#160;<span id="projectnumber">20210607</span>
   </div>
   <div id="projectbrief">The software libraries for integration of all CETONI devices.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Table&#160;of&#160;contents</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('PumpAPI.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Pump Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#PumpAPI_Introduction">Introduction</a><ul><li class="level2"><a href="#PumpAPI_General">General</a></li>
<li class="level2"><a href="#PumpAPI_ActuatorLimits">Actuator limits</a></li>
<li class="level2"><a href="#PumpAPI_ContainerLimits">Container limits</a></li>
</ul>
</li>
<li class="level1"><a href="#PumpAPI_Including">Including</a></li>
<li class="level1"><a href="#PumpAPI_Init">Initialization</a><ul><li class="level2"><a href="#PumpAPI_Step1">Step 1 - Retrieve device handle</a></li>
<li class="level2"><a href="#PumpAPI_Step2">Step 2 - Enable devices</a></li>
<li class="level2"><a href="#PumpAPI_Init_Position">Step 3 - Initialize Position Sensing System</a></li>
<li class="level2"><a href="#PumpAPI_InitExamples">Initialization Example</a></li>
<li class="level2"><a href="#PumpAPI_InitReference">InitializationReference</a></li>
</ul>
</li>
<li class="level1"><a href="#PumpAPI_Dosing">Dosing</a><ul><li class="level2"><a href="#PumpAPI_DosingExamples">Dosing Example</a></li>
<li class="level2"><a href="#PumpAPI_DosingReference">Dosing Reference</a></li>
</ul>
</li>
<li class="level1"><a href="#PumpAPI_ForceMonitoring">Force Monitoring</a></li>
<li class="level1"><a href="#PumpAPI_ContiFlow">Continuous Flow</a><ul><li class="level2"><a href="#PumpAPI_ContiFlow_Intro">Introduction into continuous flow functionality</a></li>
</ul>
</li>
<li class="level1"><a href="#PumpAPI_ProgrammingInterface">Programming Interface - API</a></li>
</ul>
</div>
<div class="textblock"><div class="image">
<img src="Slider_Pump_API_color.jpg"  align="center" style="padding-right: 10px; width: 800px;"/>
</div>
<h1><a class="anchor" id="PumpAPI_Introduction"></a>
Introduction</h1>
<h2><a class="anchor" id="PumpAPI_General"></a>
General</h2>
<p>This pump library defines a common pump control interface for a range of different pump types such as e.g. syringe pumps, dilutors, peristaltic pumps, or diaphragm pumps.</p>
<p>In general a pump consists of an actuator (like a linear drive for a syringe pump, a servo drive for a peristaltic pump or a simple DC/EC drive for a diaphragm pump) and a container for the transport of the fluid (like a syringe for a syringe pump/dilutor, a tube for a peristaltic pump or a pump head for the diaphragm pump). With some pumps like syringe pumps and peristaltic pumps the container is exchangeable by the application engineer or even by the user of the laboratory device. That means a user may mount different kind of syringes on a syringe pump or may use different tube sizes on a peristaltic pump. With other pumps (i.e. diaphragm pumps) the container and the actuator are fixed to each other and build up one single unit. The pump parameters (e.g. volume, flow or pressure) may be limited by the actuator and/or by the container.</p>
<h2><a class="anchor" id="PumpAPI_ActuatorLimits"></a>
Actuator limits</h2>
<p>On a syringe pump the flow is limited by the speed of the actuator (the velocity of the linear drive) and the volume is limited by the length/maximum position of the linear drive. On a peristaltic pump or diaphragm pump the volume is not limited by the actuator but the maximum flow is limited by the actuator speed - the maximum rotation speed of the peristaltic pump drive or the speed of the DC/EC diaphragm pump drive.</p>
<h2><a class="anchor" id="PumpAPI_ContainerLimits"></a>
Container limits</h2>
<p>Container limits are only important for devices where it is possible to change the container. On every change of the container the calculation of the flow and volume values changes and therefore the parameters maximum volume and maximum flow may also change. That means each container has its own container limits. The maximum volume of a syringe pump is limited by the stroke of the syringe piston and the inner syringe diameter. The maximum flow is limited by the inner diameter of the syringe. The tube dimensions do not limit the maximum volume of a peristaltic pump but the maximum flow is limited by the inner diameter of the tube. </p><hr/>
<h1><a class="anchor" id="PumpAPI_Including"></a>
Including</h1>
<p>The way how you include the library functions in your own windows program, depends on the compiler and on the programming language you use. In order to access the pump API, you have to include the library <b>labbCAN_Pump_API.dll</b> to your programming environment. You have to copy this file to the working directory of your system or to the application directory that contains your application EXE file. Use the calling convention <b>LCP_CALL</b> for this library. This convention is managing how the parameters are put on the stack and who is responsible to clean the stack after the function execution.</p>
<p>The interface of the library, constant definitions and declarations of the library functions, is defined in the header file <a class="el" href="labbCAN__Pump__API_8h.html">interface/labbCAN_Pump_API.h </a> </p><hr/>
<h1><a class="anchor" id="PumpAPI_Init"></a>
Initialization</h1>
<h2><a class="anchor" id="PumpAPI_Step1"></a>
Step 1 - Retrieve device handle</h2>
<p>To work with a pump, you need a valid device handle. A device handle is simply an opaque pointer to the internal device object created by the labbCAN environment. So the first thing you need do to is obtaining a valid device handle.</p>
<p>You can get a valid pump handle with the functions <a class="el" href="group__lcp__api__init.html#ga3c1006244ff7550840f4daab7ad441ce" title="Lookup for a pump device by its name. ">LCP_LookupPumpByName()</a> or <a class="el" href="group__lcp__api__init.html#ga7e5d62c2ecd3d8a21744bb82b1727067" title="Get pump handle by its index. ">LCP_GetPumpHandle()</a>:</p>
<div class="fragment"><div class="line"><a class="code" href="group__lcb__api.html#gad29975e68b6236dc4171ddbf61ae1ee5">dev_hdl</a> PumpHandle;</div>
<div class="line">Result = <a class="code" href="group__lcp__api__init.html#ga3c1006244ff7550840f4daab7ad441ce">LCP_LookupPumpByName</a>(<span class="stringliteral">&quot;Nemesys1_Pump&quot;</span>, &amp;PumpHandle);</div>
<div class="line"><a class="code" href="group__lcb__api.html#gad29975e68b6236dc4171ddbf61ae1ee5">dev_hdl</a> PumpHandle2;</div>
<div class="line">Result = <a class="code" href="group__lcp__api__init.html#ga7e5d62c2ecd3d8a21744bb82b1727067">LCP_GetPumpHandle</a>(1, &amp;PumpHandle2);</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>You can get the pump names from the device configuration files (see <a class="el" href="ConfigFiles.html">Device Configuration Files</a>)</dd></dl>
<h2><a class="anchor" id="PumpAPI_Step2"></a>
Step 2 - Enable devices</h2>
<p>If you have valid device handle, you can start to bring your devices into a properly enabled and initialized state. To do this, you need to:</p>
<ol type="1">
<li>clear all faults (<a class="el" href="group__lcp__drv.html#gafbe30da3bbf0a261787d9a74f3cf664c" title="Clear fault condition. ">LCP_ClearFault()</a>)</li>
<li>enable all pump drives (<a class="el" href="group__lcp__drv.html#ga028464a5a8e79afd034de02269669654" title="Set axis into enabled state. ">LCP_Enable()</a>)</li>
</ol>
<h2><a class="anchor" id="PumpAPI_Init_Position"></a>
Step 3 - Initialize Position Sensing System</h2>
<p>Each pump drive tracks the actual position value (volume value) by an internal position counter. If a positioning sensing system needs to get initialized depends on the type of used position sensor. Newer pumps, such as the Nemesys 4 pumps Nemesys S and Nemesys M have absolute encoders. These encoders keep their position value even when the pump is switched off. For such devices an initialization of the position sensing system is not required.</p>
<p>Other pumps, such as the older Nemesys Low Presssure Pumps or the Nemesys XL pumps use incremental encoders. If these pumps are switched off, the actual value of the position counter gets lost and is initialized to zero at next start. So right after power on, you don't know anything about the actual position of the pump drive units. For pumps like peristaltic pumps this does not matter but for pumps like syringe pumps this is very important because the position defines the actual fill level. For such devices an initialization of the position sensing system is required.</p>
<p>To find out, if an initialization is required, simply call the function <a class="el" href="group__lcp__status.html#ga1498f326fa94545a07ab01efa4344ee7" title="Returns true, if the position sensing system is properly initialized. ">LCP_IsPositionSensingInitialized()</a>. This function always returns <b>1</b> for devices with an absolute encoder. For other devices, the returned value is <b>0</b> if the position value has not been initialized yet.</p>
<p>To properly initialize the internal position counter you either need to execute a reference move via <a class="el" href="group__lcp__control.html#ga4244498259fe45378c769d7977ee852f" title="Executes a reference move for a syringe pump. ">LCP_SyringePumpCalibrate()</a> or you need to restore a previously saved position counter value via <a class="el" href="group__lcp__drv.html#ga3ae59966112bb2b4550ab6f54840eba1" title="Restore internal hardware position counter value of pump drive. ">LCP_RestoreDrivePosCnt()</a>. Because a safe reference move is possible only if there is now syringe mounted on the device, the recommended way is using <a class="el" href="group__lcp__drv.html#ga3ae59966112bb2b4550ab6f54840eba1" title="Restore internal hardware position counter value of pump drive. ">LCP_RestoreDrivePosCnt()</a>. That means, right before you shut down your system, you need to query the actual position counter value of each pump via <a class="el" href="group__lcp__drv.html#ga8091f1a97ccff80595d50e791398bc01" title="Query the value of the internal drive position counter. ">LCP_GetDrivePosCnt()</a>. Then you need to store this value into a file. The next time you start up your devices, you load the saved position values, and write it back into the devices vial <a class="el" href="group__lcp__drv.html#ga3ae59966112bb2b4550ab6f54840eba1" title="Restore internal hardware position counter value of pump drive. ">LCP_RestoreDrivePosCnt()</a>.</p>
<dl class="section warning"><dt>Warning</dt><dd>If you have a pump without absolute encoder and if you manually change the position of the pusher of this pump while it is switched off, the saved position counter value is not valid anymore and you need to execute a calibration move via <a class="el" href="group__lcp__control.html#ga4244498259fe45378c769d7977ee852f" title="Executes a reference move for a syringe pump. ">LCP_SyringePumpCalibrate()</a>.</dd></dl>
<h2>Step 4 - Ensure, that force monitoring is enabled</h2>
<p>The newer Nemesys 4 devices (Nemesys S and Nemesys M) have internal <a class="el" href="PumpAPI.html#PumpAPI_ForceMonitoring">force monitoring</a>. The execution of dosing commands is only possible if the force monitoring is active. Force monitoring can be enabled / disabled via the function <a class="el" href="group__lcp__force.html#ga1bad8f01df202cb4883c218c69101919" title="Enable / Disable force monitoring. ">LCP_EnableForceMonitoring()</a>.</p>
<h2><a class="anchor" id="PumpAPI_InitExamples"></a>
Initialization Example</h2>
<p>The following example code snippet shows a valid valid pump initialization procedure:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//============================================================================</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//                                   INCLUDES</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//============================================================================</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="labbCAN__Bus__API_8h.html">labbcan/c_api/labbCAN_Bus_API.h</a>&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="labbCAN__Pump__API_8h.html">labbcan/c_api/labbCAN_Pump_API.h</a>&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===========================================================================</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//                             STATIC DATA</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//===========================================================================</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">static</span> <a class="code" href="group__lcb__api.html#gad29975e68b6236dc4171ddbf61ae1ee5">dev_hdl</a> hPump1; <span class="comment">///&lt; stores pump handle</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//===========================================================================</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// Pump initialisation</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//===========================================================================</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<a class="code" href="err__codes_8h.html#acfd03a4962e02b139483556b046fcd2b">TErrCode</a> InitPump(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;{</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <a class="code" href="err__codes_8h.html#acfd03a4962e02b139483556b046fcd2b">TErrCode</a> Result;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    <span class="keywordtype">long</span> Retval;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="comment">// Get a pump handle for the pump that is registered with the name</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="comment">// Nemesys1_Pump</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    hPump1 = <a class="code" href="group__lcp__api__init.html#ga3c1006244ff7550840f4daab7ad441ce">LCP_LookupPumpByName</a>(<span class="stringliteral">&quot;Nemesys1_Pump&quot;</span>);</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="keywordflow">if</span> (hPump1 &lt;= 0)</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    {</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        <span class="comment">// handle error properly here</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        <span class="keywordflow">return</span> -<a class="code" href="group__err__common.html#ga74f8c3f452a7837ed2237a784cb562e3">ERR_NOENT</a>;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    }</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">// Now we check if the pump is in a fault state. We need to clear the fault</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="comment">// state first, before we can enable the pump drive</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    Retval = <a class="code" href="group__lcp__drv.html#ga606b5389f25ba64cf299d993e1aa4d25">LCP_IsInFaultState</a>(hPump1);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">if</span> (1 == Retval)</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    {</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        Result = <a class="code" href="group__lcp__drv.html#gafbe30da3bbf0a261787d9a74f3cf664c">LCP_ClearFault</a>(hPump1);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        <span class="keywordflow">if</span> (Result != <a class="code" href="group__err__common.html#ga985d3e5e6c6395353f78b3fdd7c93d58">ERR_NOERR</a>)</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        {</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;            <span class="comment">// handle error properly here</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;            <span class="keywordflow">return</span> Result;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        }</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    }</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">// Now we enable the pump drive. Enabling the pump means, power</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="comment">// will be applied to power stage of the pump drive units.</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    Result = <a class="code" href="group__lcp__drv.html#ga028464a5a8e79afd034de02269669654">LCP_Enable</a>(hPump1);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">if</span> (Result != <a class="code" href="group__err__common.html#ga985d3e5e6c6395353f78b3fdd7c93d58">ERR_NOERR</a>)</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="comment">// handle error properly here</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="keywordflow">return</span> Result;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    }</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// Now we check, if initializing the position sensing system is required.</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// If it is required, then we restore the previously saved position</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">// counter value. If we do not have a saved position counter value</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// then we need to execute a reference move via LCP_SyringePumpCalibrate().</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    Result = <a class="code" href="group__lcp__status.html#ga1498f326fa94545a07ab01efa4344ee7">LCP_IsPositionSensingInitialized</a>(hPump1);</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordflow">if</span> (!Result)</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="keywordtype">int</span> SavedPositionCounterValue = 0;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="comment">// load saved position counter value from file here</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="comment">// ...</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <span class="comment">// Now we restore the previously saved position counter value of the pumps</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="comment">// drive units</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        Result = <a class="code" href="group__lcp__drv.html#ga3ae59966112bb2b4550ab6f54840eba1">LCP_RestoreDrivePosCnt</a>(hPump1, SavedPositionCounterValue);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <span class="keywordflow">if</span> (Result != <a class="code" href="group__err__common.html#ga985d3e5e6c6395353f78b3fdd7c93d58">ERR_NOERR</a>)</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            <span class="comment">// handle error properly here</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            <span class="keywordflow">return</span> Result;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        }        </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// Now we setup volume and flow SI units - or we restore the values saved</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// to file previously. We would like to use milliliters as volume unit and</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// milliliters / second as flow unit</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <a class="code" href="group__lcp__cfg.html#gaba372b5d234a76989a546889ab090e3d">LCP_SetVolumeUnit</a>(hPump1, <a class="code" href="group__lca__prefix.html#gadeb4b9151c69e22165f63162cc43e459">MILLI</a>, <a class="code" href="group__lcp__volunit.html#gaaadcfe07e55b7fa5dd965834ee23ce7d">LITRES</a>);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="group__lcp__cfg.html#gaa287bb78fe20086e29a4a93250aa1e01">LCP_SetFlowUnit</a>(hPump1, <a class="code" href="group__lca__prefix.html#gadeb4b9151c69e22165f63162cc43e459">MILLI</a>, <a class="code" href="group__lcp__volunit.html#gaaadcfe07e55b7fa5dd965834ee23ce7d">LITRES</a>, <a class="code" href="group__lca__timeunit.html#gaeb95b49da835b156fe8334f8c35e2b19">PER_SECOND</a>);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// Now we configure the syringe parameters of the syringe that is currently</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// mounted on our syringe pump device - we use a syringe with 2 mm innder</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// diameter and 60 mm piston stroke.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    Result = <a class="code" href="group__lcp__cfg.html#gaf32aa98b9316c73afaef12bb770bd21d">LCP_SetSyringeParam</a>(hPump1, 2, 60);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">if</span> (Result != <a class="code" href="group__err__common.html#ga985d3e5e6c6395353f78b3fdd7c93d58">ERR_NOERR</a>)</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    {</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="comment">// handle error properly here</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="keywordflow">return</span> Result;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    }</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// now the pump is properly initialized and we can start dosing</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">return</span> Result;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;}</div>
<div class="ttc" id="group__lcp__cfg_html_gaba372b5d234a76989a546889ab090e3d"><div class="ttname"><a href="group__lcp__cfg.html#gaba372b5d234a76989a546889ab090e3d">LCP_SetVolumeUnit</a></div><div class="ttdeci">LCP_Func long LCP_CALL LCP_SetVolumeUnit(dev_hdl hPump, int Prefix, int VolumeUnit)</div><div class="ttdoc">This function sets the default volume unit. </div></div>
<div class="ttc" id="labbCAN__Pump__API_8h_html"><div class="ttname"><a href="labbCAN__Pump__API_8h.html">labbCAN_Pump_API.h</a></div><div class="ttdoc">labbCAN Pump Application Programming Interface </div></div>
<div class="ttc" id="group__err__common_html_ga74f8c3f452a7837ed2237a784cb562e3"><div class="ttname"><a href="group__err__common.html#ga74f8c3f452a7837ed2237a784cb562e3">ERR_NOENT</a></div><div class="ttdeci">#define ERR_NOENT</div><div class="ttdoc">No such entity. </div><div class="ttdef"><b>Definition:</b> err_codes.h:104</div></div>
<div class="ttc" id="group__lcp__cfg_html_gaf32aa98b9316c73afaef12bb770bd21d"><div class="ttname"><a href="group__lcp__cfg.html#gaf32aa98b9316c73afaef12bb770bd21d">LCP_SetSyringeParam</a></div><div class="ttdeci">LCP_Func long LCP_CALL LCP_SetSyringeParam(dev_hdl hPump, double InnerDiameter_mm, double MaxPistonStroke_mm)</div><div class="ttdoc">Set syringe parameters. </div></div>
<div class="ttc" id="group__lcp__cfg_html_gaa287bb78fe20086e29a4a93250aa1e01"><div class="ttname"><a href="group__lcp__cfg.html#gaa287bb78fe20086e29a4a93250aa1e01">LCP_SetFlowUnit</a></div><div class="ttdeci">LCP_Func long LCP_CALL LCP_SetFlowUnit(dev_hdl hPump, int Prefix, int VolumeUnit, int TimeUnit)</div><div class="ttdoc">Sets the flow unit for a certain pump. </div></div>
<div class="ttc" id="group__lca__timeunit_html_gaeb95b49da835b156fe8334f8c35e2b19"><div class="ttname"><a href="group__lca__timeunit.html#gaeb95b49da835b156fe8334f8c35e2b19">PER_SECOND</a></div><div class="ttdeci">#define PER_SECOND</div><div class="ttdoc">PER_SECOND. </div><div class="ttdef"><b>Definition:</b> labbCAN_MotionControl_API.h:214</div></div>
<div class="ttc" id="err__codes_8h_html_acfd03a4962e02b139483556b046fcd2b"><div class="ttname"><a href="err__codes_8h.html#acfd03a4962e02b139483556b046fcd2b">TErrCode</a></div><div class="ttdeci">int32_t TErrCode</div><div class="ttdoc">Error code type. </div><div class="ttdef"><b>Definition:</b> err_codes.h:50</div></div>
<div class="ttc" id="group__lcp__drv_html_gafbe30da3bbf0a261787d9a74f3cf664c"><div class="ttname"><a href="group__lcp__drv.html#gafbe30da3bbf0a261787d9a74f3cf664c">LCP_ClearFault</a></div><div class="ttdeci">LCP_Func long LCP_CALL LCP_ClearFault(dev_hdl hPump)</div><div class="ttdoc">Clear fault condition. </div></div>
<div class="ttc" id="group__lcp__status_html_ga1498f326fa94545a07ab01efa4344ee7"><div class="ttname"><a href="group__lcp__status.html#ga1498f326fa94545a07ab01efa4344ee7">LCP_IsPositionSensingInitialized</a></div><div class="ttdeci">LCP_Func long LCP_CALL LCP_IsPositionSensingInitialized(dev_hdl hPump)</div><div class="ttdoc">Returns true, if the position sensing system is properly initialized. </div></div>
<div class="ttc" id="group__lcb__api_html_gad29975e68b6236dc4171ddbf61ae1ee5"><div class="ttname"><a href="group__lcb__api.html#gad29975e68b6236dc4171ddbf61ae1ee5">dev_hdl</a></div><div class="ttdeci">long long dev_hdl</div><div class="ttdoc">generic device handle </div><div class="ttdef"><b>Definition:</b> labbCAN_Bus_API.h:172</div></div>
<div class="ttc" id="group__lcp__drv_html_ga3ae59966112bb2b4550ab6f54840eba1"><div class="ttname"><a href="group__lcp__drv.html#ga3ae59966112bb2b4550ab6f54840eba1">LCP_RestoreDrivePosCnt</a></div><div class="ttdeci">LCP_Func long LCP_CALL LCP_RestoreDrivePosCnt(dev_hdl hPump, long PosCntValue)</div><div class="ttdoc">Restore internal hardware position counter value of pump drive. </div></div>
<div class="ttc" id="group__err__common_html_ga985d3e5e6c6395353f78b3fdd7c93d58"><div class="ttname"><a href="group__err__common.html#ga985d3e5e6c6395353f78b3fdd7c93d58">ERR_NOERR</a></div><div class="ttdeci">#define ERR_NOERR</div><div class="ttdoc">No error. </div><div class="ttdef"><b>Definition:</b> err_codes.h:102</div></div>
<div class="ttc" id="group__lcp__volunit_html_gaaadcfe07e55b7fa5dd965834ee23ce7d"><div class="ttname"><a href="group__lcp__volunit.html#gaaadcfe07e55b7fa5dd965834ee23ce7d">LITRES</a></div><div class="ttdeci">#define LITRES</div><div class="ttdoc">Litres. </div><div class="ttdef"><b>Definition:</b> labbCAN_Pump_API.h:67</div></div>
<div class="ttc" id="group__lcp__drv_html_ga606b5389f25ba64cf299d993e1aa4d25"><div class="ttname"><a href="group__lcp__drv.html#ga606b5389f25ba64cf299d993e1aa4d25">LCP_IsInFaultState</a></div><div class="ttdeci">LCP_Func long LCP_CALL LCP_IsInFaultState(dev_hdl hPump)</div><div class="ttdoc">Check if pump is in a fault state. </div></div>
<div class="ttc" id="group__lca__prefix_html_gadeb4b9151c69e22165f63162cc43e459"><div class="ttname"><a href="group__lca__prefix.html#gadeb4b9151c69e22165f63162cc43e459">MILLI</a></div><div class="ttdeci">#define MILLI</div><div class="ttdoc">MILLI. </div><div class="ttdef"><b>Definition:</b> labbCAN_MotionControl_API.h:227</div></div>
<div class="ttc" id="group__lcp__api__init_html_ga3c1006244ff7550840f4daab7ad441ce"><div class="ttname"><a href="group__lcp__api__init.html#ga3c1006244ff7550840f4daab7ad441ce">LCP_LookupPumpByName</a></div><div class="ttdeci">LCP_Func long LCP_CALL LCP_LookupPumpByName(const char *pPumpName, dev_hdl *PumpHandle)</div><div class="ttdoc">Lookup for a pump device by its name. </div></div>
<div class="ttc" id="group__lcp__drv_html_ga028464a5a8e79afd034de02269669654"><div class="ttname"><a href="group__lcp__drv.html#ga028464a5a8e79afd034de02269669654">LCP_Enable</a></div><div class="ttdeci">LCP_Func long LCP_CALL LCP_Enable(dev_hdl hPump)</div><div class="ttdoc">Set axis into enabled state. </div></div>
<div class="ttc" id="labbCAN__Bus__API_8h_html"><div class="ttname"><a href="labbCAN__Bus__API_8h.html">labbCAN_Bus_API.h</a></div><div class="ttdoc">labbCAN Bus Application Programming Interface </div></div>
</div><!-- fragment --><h2><a class="anchor" id="PumpAPI_InitReference"></a>
InitializationReference</h2>
<p>See the <a class="el" href="group__lcp__api__init.html">Pump API Initialisation</a> module and the <a class="el" href="group__lcp__cfg.html">Pump Configuration</a> module for a detailed reference of all pump initialization and configuration functions. </p><hr/>
<h1><a class="anchor" id="PumpAPI_Dosing"></a>
Dosing</h1>
<p>For almost all dosing tasks the functions from the <a class="el" href="group__lcp__control.html">Pump Control</a> module and from the <a class="el" href="group__lcp__status.html">Pump Status</a> module are required. Using the pump API you can choose from a number of different dosing modes:</p>
<ul>
<li><a class="el" href="group__lcp__control.html#ga0f7ba07679f84c029b4d04fd5727e6d0" title="Aspirate a certain volume with a certain flow rate. ">LCP_Aspirate()</a> for the aspiration of a certain volume with a certain flow</li>
<li><a class="el" href="group__lcp__control.html#ga39c20d623dfb079a997d4c2ade4ab247" title="Dispense a certain volume with a certain flow rate. ">LCP_Dispense()</a> for dispension of a certain volume</li>
<li><a class="el" href="group__lcp__control.html#ga247f943ce79019c110d0a5bec4356da5" title="Pump a certain volume with a certain flow rate. ">LCP_PumpVolume()</a> for aspiration or dispension depending on the sign of the flow rate parameter (negativ = aspiration, positive = dispension)</li>
<li><a class="el" href="group__lcp__control.html#ga30d9cbe00c230ff516de53cacc8aba8b" title="Pumps fluid with the given flow rate until the requested fill level is reached. ">LCP_SetFillLevel()</a> aspirates or dispenses until a certain syringe fill level is reached</li>
<li><a class="el" href="group__lcp__control.html#gab3f8ecc6ac6b570c951df80e87ffd513" title="Generate a continuous flow. ">LCP_GenerateFlow()</a> generates a constant flow - dosing continues until it gets stopped manually or until pusher reached one of its limits.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>All dosing functions are non blocking. That means each function returns Immediately after the dosing process has been started and you need to poll the <a class="el" href="group__lcp__status.html#gad2017735e9c8f21ca9748ace31c995bc" title="Check if device is currently stopped or dosing. ">LCP_IsPumping()</a> function to detect if dosing has been finished.</dd></dl>
<p>With the status functions you can always query the actual state of the pumps you are working with:</p>
<ul>
<li><a class="el" href="group__lcp__status.html#ga285f4d72c33f039758631395bfa5b78b" title="Get the already dosed volume. ">LCP_GetDosedVolume()</a> returns the dosed volume since start of last dosage</li>
<li><a class="el" href="group__lcp__status.html#ga31e812bfafc8f4486fcde4c5f59a903d" title="Returns the actual fill level of the pump. ">LCP_GetFillLevel()</a>returns the actual fill level of the pump container (eg.syringe)</li>
<li><a class="el" href="group__lcp__status.html#gaa787d1c0bbb48e6b53320fe4c05e4235" title="Read the actual flow rate. ">LCP_GetFlowIs()</a> always returns the actual flow rate of the pump</li>
<li><a class="el" href="group__lcp__status.html#gad2017735e9c8f21ca9748ace31c995bc" title="Check if device is currently stopped or dosing. ">LCP_IsPumping()</a> returns true (1) as long as dosing is active.</li>
</ul>
<h2><a class="anchor" id="PumpAPI_DosingExamples"></a>
Dosing Example</h2>
<p>The following example code snippet shows how to empty a syringe completely and then aspirate a certain volume with a certain flow rate. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//============================================================================</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//                                   INCLUDES</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//============================================================================</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="labbCAN__Bus__API_8h.html">labbcan/c_api/labbCAN_Bus_API.h</a>&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="labbCAN__Pump__API_8h.html">labbcan/c_api/labbCAN_Pump_API.h</a>&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//===========================================================================</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//                             STATIC DATA</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">//===========================================================================</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">static</span> <a class="code" href="group__lcb__api.html#gad29975e68b6236dc4171ddbf61ae1ee5">dev_hdl</a> hPump1; <span class="comment">///&lt; stores pump handle</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//===========================================================================</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// Pump dosage</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">//===========================================================================</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<a class="code" href="err__codes_8h.html#acfd03a4962e02b139483556b046fcd2b">TErrCode</a> PumpDosageExample(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;{</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <a class="code" href="err__codes_8h.html#acfd03a4962e02b139483556b046fcd2b">TErrCode</a> Result;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    <span class="keywordtype">long</span> Retval;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="comment">// First we completely empty the syringe (fill level 0) with the maximum</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="comment">// flow rate</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="keywordtype">double</span> MaximumFlow;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    Result = <a class="code" href="group__lcp__cfg.html#gada6609aae1a4af8d85f0a08b7e98f5ea">LCP_GetFlowRateMax</a>(hNemesys1, &amp;MaximumFlow);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    Result = <a class="code" href="group__lcp__control.html#ga30d9cbe00c230ff516de53cacc8aba8b">LCP_SetFillLevel</a>(hPump1, 0, MaximumFlow);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keywordflow">if</span> (Result != <a class="code" href="group__err__common.html#ga985d3e5e6c6395353f78b3fdd7c93d58">ERR_NOERR</a>)</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    {</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        <span class="comment">// handle error properly here</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        <span class="keywordflow">return</span> Result;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    }</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    Sleep(100); <span class="comment">// Give pump some time to start dosage</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="comment">// The loop continues until pump finished dosage</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">do</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    {</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        Retval = <a class="code" href="group__lcp__status.html#gad2017735e9c8f21ca9748ace31c995bc">LCP_IsPumping</a>(hPump1);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <span class="keywordflow">if</span> (Result != <a class="code" href="group__err__common.html#ga985d3e5e6c6395353f78b3fdd7c93d58">ERR_NOERR</a>)</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            <span class="comment">// handle error properly here</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;            <span class="keywordflow">return</span> Result;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        }</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        Sleep(50); <span class="comment">// do not take all processor time with this loop</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">while</span> (Retval &gt; 0);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// now we aspirate 0.1 ml with a flow rate of 0.004 ml/s</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    Result = <a class="code" href="group__lcp__control.html#ga0f7ba07679f84c029b4d04fd5727e6d0">LCP_Aspirate</a>(hPump1, 0.1, 0.004);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">if</span> (Result != <a class="code" href="group__err__common.html#ga985d3e5e6c6395353f78b3fdd7c93d58">ERR_NOERR</a>)</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <span class="comment">// handle error properly here</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="keywordflow">return</span> Result;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    }</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="group__err__common.html#ga985d3e5e6c6395353f78b3fdd7c93d58">ERR_NOERR</a>;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;}</div>
<div class="ttc" id="group__lcp__control_html_ga30d9cbe00c230ff516de53cacc8aba8b"><div class="ttname"><a href="group__lcp__control.html#ga30d9cbe00c230ff516de53cacc8aba8b">LCP_SetFillLevel</a></div><div class="ttdeci">LCP_Func long LCP_CALL LCP_SetFillLevel(dev_hdl hPump, double Level, double Flow)</div><div class="ttdoc">Pumps fluid with the given flow rate until the requested fill level is reached. </div></div>
<div class="ttc" id="group__lcp__control_html_ga0f7ba07679f84c029b4d04fd5727e6d0"><div class="ttname"><a href="group__lcp__control.html#ga0f7ba07679f84c029b4d04fd5727e6d0">LCP_Aspirate</a></div><div class="ttdeci">LCP_Func long LCP_CALL LCP_Aspirate(dev_hdl hPump, double Volume, double Flow)</div><div class="ttdoc">Aspirate a certain volume with a certain flow rate. </div></div>
<div class="ttc" id="labbCAN__Pump__API_8h_html"><div class="ttname"><a href="labbCAN__Pump__API_8h.html">labbCAN_Pump_API.h</a></div><div class="ttdoc">labbCAN Pump Application Programming Interface </div></div>
<div class="ttc" id="err__codes_8h_html_acfd03a4962e02b139483556b046fcd2b"><div class="ttname"><a href="err__codes_8h.html#acfd03a4962e02b139483556b046fcd2b">TErrCode</a></div><div class="ttdeci">int32_t TErrCode</div><div class="ttdoc">Error code type. </div><div class="ttdef"><b>Definition:</b> err_codes.h:50</div></div>
<div class="ttc" id="group__lcb__api_html_gad29975e68b6236dc4171ddbf61ae1ee5"><div class="ttname"><a href="group__lcb__api.html#gad29975e68b6236dc4171ddbf61ae1ee5">dev_hdl</a></div><div class="ttdeci">long long dev_hdl</div><div class="ttdoc">generic device handle </div><div class="ttdef"><b>Definition:</b> labbCAN_Bus_API.h:172</div></div>
<div class="ttc" id="group__lcp__status_html_gad2017735e9c8f21ca9748ace31c995bc"><div class="ttname"><a href="group__lcp__status.html#gad2017735e9c8f21ca9748ace31c995bc">LCP_IsPumping</a></div><div class="ttdeci">LCP_Func long LCP_CALL LCP_IsPumping(dev_hdl hPump)</div><div class="ttdoc">Check if device is currently stopped or dosing. </div></div>
<div class="ttc" id="group__err__common_html_ga985d3e5e6c6395353f78b3fdd7c93d58"><div class="ttname"><a href="group__err__common.html#ga985d3e5e6c6395353f78b3fdd7c93d58">ERR_NOERR</a></div><div class="ttdeci">#define ERR_NOERR</div><div class="ttdoc">No error. </div><div class="ttdef"><b>Definition:</b> err_codes.h:102</div></div>
<div class="ttc" id="group__lcp__cfg_html_gada6609aae1a4af8d85f0a08b7e98f5ea"><div class="ttname"><a href="group__lcp__cfg.html#gada6609aae1a4af8d85f0a08b7e98f5ea">LCP_GetFlowRateMax</a></div><div class="ttdeci">LCP_Func long LCP_CALL LCP_GetFlowRateMax(dev_hdl hPump, double *FlowRateMax)</div><div class="ttdoc">Get maximum flow rate that is realizable with current dosing unit configuration. </div></div>
<div class="ttc" id="labbCAN__Bus__API_8h_html"><div class="ttname"><a href="labbCAN__Bus__API_8h.html">labbCAN_Bus_API.h</a></div><div class="ttdoc">labbCAN Bus Application Programming Interface </div></div>
</div><!-- fragment --><h2><a class="anchor" id="PumpAPI_DosingReference"></a>
Dosing Reference</h2>
<p>See the <a class="el" href="group__lcp__control.html">Pump Control</a> module and the <a class="el" href="group__lcp__status.html">Pump Status</a> module for a detailed reference of all pump dosing and status functions. </p><hr/>
<h1><a class="anchor" id="PumpAPI_ForceMonitoring"></a>
Force Monitoring</h1>
<h2>Overview of the force monitoring functionality</h2>
<p>The newer Nemesys 4 pumps, such as Nemesys S and Nemesys M, have an internal force sensor for force monitoring and safety stop in case of too high forces (pressures). To find out if a pump supports force monitoring you can use the function <a class="el" href="group__lcp__force.html#gac0cb1e7f2f710a83b7b340558dac1413" title="With this function you can check if the pump given in hPump parameter supports force monitoring funct...">LCP_HasForceMonitoring()</a>. Only if this function returns <b>1</b> the <a class="el" href="group__lcp__force.html">force monitoring functions</a> are supported. Each pump has an internal hardware specific maximum force. To find out the maximum force, simply call <a class="el" href="group__lcp__force.html#ga15c3d296ca5cd7ae8f47026167b43139" title="Returns the maximum device force. ">LCP_GetMaxDeviceForce()</a>. If the force of the device raises above this maximum force, the pump drive is stopped immediately.</p>
<dl class="section note"><dt>Note</dt><dd>If you would like to know the SI unit that is used for all force values, call <a class="el" href="group__lcp__force.html#ga6d7097be02777d20594c4bac0a84742b" title="Return the force unit used for all force monitoring related functions. ">LCP_GetForceUnit()</a></dd></dl>
<p>It is possible to reduce the force limit below the maximum device force by setting a custom force limit if this is required by your application. You can do this by calling the function <a class="el" href="group__lcp__force.html#ga03cf61c168202ba59eea78c6f1a3dd92" title="Sets a custom force limit. ">LCP_WriteForceLimit()</a>.</p>
<div class="fragment"><div class="line"><span class="comment">// Reduce the force limit to 0.2 kN</span></div>
<div class="line">Result = <a class="code" href="group__lcp__force.html#ga03cf61c168202ba59eea78c6f1a3dd92">LCP_WriteForceLimit</a>(Pump1, 0.2);</div>
</div><!-- fragment --><p>If you would like to know the current force limit, simply call <a class="el" href="group__lcp__force.html#ga77d252a491f0c4a25ec118390ecaf0c2" title="Returns the force limit. ">LCP_GetForceLimit()</a>. The force limit defines the threshold for triggering the safety stop. If a safety stop is triggered, the pump drive is stopped and the safety stop input of the pump is set. To find out, if you are in a force overload situation, that means if the safety stop is active, you can read the state of the safety stop input via <a class="el" href="group__lcp__force.html#ga67356f2e82d910957aaccb8f634243f0" title="Reads the safety stop input. ">LCP_IsForceSafetyStopActive()</a>. If this function returns <b>1</b> then you know, that the pump has been stopped because of an force overload.</p>
<h2>How to resolve a force overload situation</h2>
<p>If the safety stop is active, it is no longer possible to carry out any dosing with the pump. To resolve this force overload situation, you need to reduce the force below the force limit threshold. There are different ways to reduce the pressure:</p>
<ol type="1">
<li>by using some kind of overpressure valve</li>
<li>by waiting until the pressure is released</li>
<li>by pulling back the syringe plunger (aspirating)</li>
</ol>
<p>Pulling the syringe plunger is not possible as long as the safety stop input is active. To reduce the pressure by pulling the syringe plunger, you first need to disable the force monitoring by calling <a class="el" href="group__lcp__force.html#ga1bad8f01df202cb4883c218c69101919" title="Enable / Disable force monitoring. ">LCP_EnableForceMonitoring()</a> function. This will clear the safety stop input.</p>
<dl class="section note"><dt>Note</dt><dd>Moving the syringe plunger when force monitoring is disabled is only possible in a force overload situation. If you disable force monitoring if the force is in the allowed range, then dosing is not possible.</dd></dl>
<p>If force monitoring is disabled, you can pull the syringe plunger by executing a flow command with a negative flow rate (aspirating). The following example shows how to do this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> MaxFlow;</div>
<div class="line"><span class="keywordtype">double</span> Flow;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Disable force monitoring</span></div>
<div class="line">Result = <a class="code" href="group__lcp__force.html#ga1bad8f01df202cb4883c218c69101919">LCP_EnableForceMonitoring</a>(Pump1, 0);</div>
<div class="line"></div>
<div class="line"><span class="comment">// We use a small negative flow rate here, to pull the syringe plunger</span></div>
<div class="line">Result = <a class="code" href="group__lcp__cfg.html#gada6609aae1a4af8d85f0a08b7e98f5ea">LCP_GetFlowRateMax</a>(Pump1, &amp;MaxFlow);</div>
<div class="line">Flow = 0 - (MaxFlow / 100);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Now we start the negative flow</span></div>
<div class="line">Result = <a class="code" href="group__lcp__control.html#gab3f8ecc6ac6b570c951df80e87ffd513">LCP_GenerateFlow</a>(Pump1, Flow);</div>
</div><!-- fragment --><p>Now the syringe plunger will be pulled slowly out of the syringe and the pressure (force) will decrease. If the force falls below the force limit, then the safety stop input will be set and the pump will be stopped. To detect this event, you just need to monitor the safety stop input via <a class="el" href="group__lcp__force.html#ga67356f2e82d910957aaccb8f634243f0" title="Reads the safety stop input. ">LCP_IsForceSafetyStopActive()</a>.</p>
<div class="fragment"><div class="line"><span class="keywordflow">do</span></div>
<div class="line">{</div>
<div class="line">    SafetyStopActive = <a class="code" href="group__lcp__force.html#ga67356f2e82d910957aaccb8f634243f0">LCP_IsForceSafetyStopActive</a>(Pump);</div>
<div class="line">    CThread::sleep(500);</div>
<div class="line">} <span class="keywordflow">while</span> (!SafetyStopActive);</div>
</div><!-- fragment --><p>Now you can enable force monitoring again using <a class="el" href="group__lcp__force.html#ga1bad8f01df202cb4883c218c69101919" title="Enable / Disable force monitoring. ">LCP_EnableForceMonitoring()</a> and the force overload situation is resolved.</p>
<dl class="section note"><dt>Note</dt><dd>The force monitoring functionality has a hysteresis. In case of a force overload situation you need to lower the force ca. 0.1 kN to clear the safety stop input. If this is not possible, you can lower the force less (for example 0.02 kN) and then call the function <a class="el" href="group__lcp__force.html#ga07f7fa3735ca5825900d83d3027b0b02" title="Clear / acknowledge force safety stop. ">LCP_ClearForceSafetyStop()</a> to clear the safety stop input.</dd></dl>
<h2>Reading the force sensor</h2>
<p>If you would like to monitor or log the force sensor value, you can read the current force using the function <a class="el" href="group__lcp__force.html#ga43092b1bf8701dfac72b0ac9793f9071" title="Reads the force sensor and returns the measured force in the unit returned by LCP_GetForceUnit(). ">LCP_ReadForceSensor()</a>. This will return the current force value in the SI unit returned by <a class="el" href="group__lcp__force.html#ga6d7097be02777d20594c4bac0a84742b" title="Return the force unit used for all force monitoring related functions. ">LCP_GetForceUnit()</a>.</p>
<h2>Force Monitoring API Reference</h2>
<p>See the <a class="el" href="group__lcp__force.html">Force Monitoring</a> module for a detailed description and reference of all force monitoring functions. </p><hr/>
<h1><a class="anchor" id="PumpAPI_ContiFlow"></a>
Continuous Flow</h1>
<h2><a class="anchor" id="PumpAPI_ContiFlow_Intro"></a>
Introduction into continuous flow functionality</h2>
<p>A disadvantage of syringe pumps is that the maximum dosable volume is limited by the syringe. If the syringe is empty, the syringe must be refilled. During the refill cycle the dosing is interrupted. To solve this problem and enable uninterrupted, continuous dosing, the SDK offers Continuous Flow functionality.</p>
<p>To generate a continuous flow, two syringe pumps are connected by software to form a virtual continuous flow pump. The continuous flow algorithm then controls the alternating filling and emptying of the syringe, thus creating a continuous flow. The creation of the virtual continuous flow pump can be done during runtime via <a class="el" href="group__lcp__conti.html">library functions</a> or by declaring the continuous flow pump in the <a class="el" href="ConfigFiles.html">device configuration file</a>.</p>
<h2>Declare a continuous flow pump in device configuration file</h2>
<p>The CETONI SDK requires a <a class="el" href="GettingStarted.html">device configuration</a> (a set of XML files) to control the supported devices. So the first step is to create a device configuration in the <a href="https://www.cetoni.com/products/qmixelements/">QmixElements</a> software with at least 2 neMESYS syringe pumps. The device configuration folder now contains several XML files. Open the file <b>nemesys.xml</b> with an editor thats supports syntax highlighting (such as <a href="https://notepad-plus-plus.org/">Notepad++</a>).</p>
<dl class="section note"><dt>Note</dt><dd>Make a backup of your device configuration before you start editing files manually.</dd></dl>
<p>Now scroll to the end of the <code>&lt;Plugin&gt;&lt;labbCAN&gt;&lt;DeviceList&gt;</code> section to insert a new device declaration. The following example shows the declaration of a continuous flow pump at the end of the <code>&lt;DeviceList&gt;</code> section:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;Device Name=&quot;ContiFlowPump_1&quot;&gt;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &lt;Type&gt;Lcl::CContiFlowPump&lt;/Type&gt;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &lt;Pump1 Device=&quot;neMESYS_Low_Pressure_1_Pump&quot;&gt;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &lt;Valve1 Device=&quot;neMESYS_Low_Pressure_1_Valve&quot; AspiratingPos=&quot;1&quot; DispensingPos=&quot;0&quot; ClosedPos=&quot;-1&quot;/&gt;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;/Pump1&gt;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &lt;Pump2 Device=&quot;neMESYS_Low_Pressure_2_Pump&quot;&gt;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &lt;Valve1 Device=&quot;neMESYS_Low_Pressure_2_Valve&quot; AspiratingPos=&quot;1&quot; DispensingPos=&quot;0&quot; ClosedPos=&quot;-1&quot;/&gt;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &lt;/Pump2&gt;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&lt;/Device&gt;</div>
</div><!-- fragment --><p>The following things are declared in the example:</p>
<ul>
<li><b>line 1</b>: the device is declared and a unique name <code>ContiFlowPump_1</code> is given</li>
<li><b>line 2</b>: the device type is declared - this is always <code>Lcl::CContiFlowPump</code> for a continuous flow pump</li>
<li><b>line 3</b>: the syringe pump <code>neMESYS_Low_Pressure_1_Pump</code> is assigned as the first pump channel. The syringe pump with the given name must exist in the device list above</li>
<li><b>line 4</b>: the first valve <code>neMESYS_Low_Pressure_1_Valve</code> is assigned to the first syringe pump channel. For the valve the switching positions are configured for aspirating, dispensing and closed state. A value of -1 indicates that this position is not used and will not be switched.</li>
</ul>
<p>In the following lines the second pump and the valve for the second pump are declared.</p>
<dl class="section note"><dt>Note</dt><dd>All devices (valves and pumps) that are assigned to the continuous flow pump must exist in the device list above.</dd></dl>
<p>If you now load this device configuration into the CETONI SDK, then you can easily access the continues flow pump from source code:</p>
<div class="fragment"><div class="line"><a class="code" href="group__lcb__api.html#gad29975e68b6236dc4171ddbf61ae1ee5">dev_hdl</a> ContiFlowPump;</div>
<div class="line"><a class="code" href="err__codes_8h.html#acfd03a4962e02b139483556b046fcd2b">TErrCode</a> Result = <a class="code" href="group__lcp__api__init.html#ga3c1006244ff7550840f4daab7ad441ce">LCP_LookupPumpByName</a>(<span class="stringliteral">&quot;ContiFlowPump_1&quot;</span>, &amp;ContiFlowPump);</div>
</div><!-- fragment --><h2>Create a continuous flow pump in source code</h2>
<p>As an alternative to creating the pump via the configuration file, the pump can also be created in source code at runtime. The first step is to obtain the device handles for all devices that should be combined into a continuous flow pump. Any error checking code has been removed to keep the example simple.</p>
<div class="fragment"><div class="line"><a class="code" href="err__codes_8h.html#acfd03a4962e02b139483556b046fcd2b">TErrCode</a> Result;</div>
<div class="line"><a class="code" href="group__lcb__api.html#gad29975e68b6236dc4171ddbf61ae1ee5">dev_hdl</a> SyringePump1;</div>
<div class="line"><a class="code" href="group__lcb__api.html#gad29975e68b6236dc4171ddbf61ae1ee5">dev_hdl</a> SyringePump2;</div>
<div class="line"><a class="code" href="group__lcb__api.html#gad29975e68b6236dc4171ddbf61ae1ee5">dev_hdl</a> Valve1;</div>
<div class="line"><a class="code" href="group__lcb__api.html#gad29975e68b6236dc4171ddbf61ae1ee5">dev_hdl</a> Valve2;</div>
<div class="line"></div>
<div class="line">Result = <a class="code" href="group__lcp__api__init.html#ga3c1006244ff7550840f4daab7ad441ce">LCP_LookupPumpByName</a>(<span class="stringliteral">&quot;neMESYS_Low_Pressure_1_Pump&quot;</span>, &amp;SyringePump1);</div>
<div class="line">Result = <a class="code" href="group__lcp__api__init.html#ga3c1006244ff7550840f4daab7ad441ce">LCP_LookupPumpByName</a>(<span class="stringliteral">&quot;neMESYS_Low_Pressure_2_Pump&quot;</span>, &amp;SyringePump2);</div>
<div class="line">Result = <a class="code" href="group__lcv__api__init.html#ga0cc21ece611b7c5e111de0b57e68c582">LCV_LookupValveByName</a>(<span class="stringliteral">&quot;neMESYS_Low_Pressure_1_Valve&quot;</span>, &amp;Valve1);</div>
<div class="line">Result = <a class="code" href="group__lcv__api__init.html#ga0cc21ece611b7c5e111de0b57e68c582">LCV_LookupValveByName</a>(<span class="stringliteral">&quot;neMESYS_Low_Pressure_2_Valve&quot;</span>, &amp;Valve2);</div>
</div><!-- fragment --><p>If you have all required device handles, you can start to create the pump device:</p>
<div class="fragment"><div class="line"><a class="code" href="group__lcb__api.html#gad29975e68b6236dc4171ddbf61ae1ee5">dev_hdl</a> ContiFlowPump;</div>
<div class="line"></div>
<div class="line">Result = <a class="code" href="group__lcp__conti.html#ga2fc41b97a185361a1e896a86cef37629">LCP_CreateContiFlowPump</a>(SyringePump1, SyringePump2, &amp;ContiFlowPump);</div>
<div class="line">Result = <a class="code" href="group__lcp__conti.html#ga43c783323330c578744208ba1018eee3">LCP_ConfigureContiFlowValve</a>(ContiFlowPump, 0, 0, Valve1, 1, 0, -1);</div>
<div class="line">Result = <a class="code" href="group__lcp__conti.html#ga43c783323330c578744208ba1018eee3">LCP_ConfigureContiFlowValve</a>(ContiFlowPump, 1, 0, Valve2, 1, 0, -1);</div>
</div><!-- fragment --><p>First the continuoues flow pump is created by assigning the two syringe pumps. The device handle is returned in the <code>ContiFlowPump</code> variable. Then the first valve for the first pump channel is configured and the the first valve for the second pump channel. After these steps, the continuous flow pump has the same configuration like the pump created via the device configuration file above.</p>
<h2>Parameterize the continuous flow</h2>
<p>If you have a valid continuous flow pump handle, you can start to parameterize the continuous flow. This is the same procedure like you know if from the continuous flow wizard in the QmixElements software. At the moment, the continus flow pump supports only cross flow switching. This means, the cross flow algorithm provides a soft transition and a constant flow rate when switching from one dosing unit to the other. This mode is most suitable if your application uses a low system pressure and you dont have pressure sensors.</p>
<p>The first thing you need to configure is the switching mode for the continuous flow. At the moment only the cross flow is supported but pressure controlled switching will come soon.</p>
<div class="fragment"><div class="line">Result = <a class="code" href="group__lcb__device.html#ga7c78fb828f13b078ceb4af5ac689003b">LCB_SetDeviceProperty</a>(ContiFlowPump, <a class="code" href="group__lcp__conti.html#gga2b569e9a1f7717f3d474fafe10ec6120aa5e84e27f6bd806464703b39a15ba868">PropertySwitchingMode</a>, <a class="code" href="group__lcp__api.html#ggad4b89ebdbaa9cb3c40425d6b0cd40bffadbf054c547cf5b3e1307f4c4f7a13742">SwitchingCrossFlow</a>);</div>
</div><!-- fragment --><p>Then you need to configure the maximum refill flow rate that is allowed in your application. If you would like to know the maximum possible refill flow, then you can query it like this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> MaxRefillFlow;</div>
<div class="line">Result = <a class="code" href="group__lcb__device.html#gaf2bd6cc6185a4e1cea173bc576300e70">LCB_GetDeviceProperty</a>(ContiFlowPump, <a class="code" href="group__lcp__conti.html#gga2b569e9a1f7717f3d474fafe10ec6120acbaab73d5ba7760975b8d98606fc67a7">PropertyMaxRefillFlow</a>, &amp;MaxRefillFlow);</div>
</div><!-- fragment --><p>Then you can limit the maximum flow rate like this:</p>
<div class="fragment"><div class="line">Result = <a class="code" href="group__lcb__device.html#ga7c78fb828f13b078ceb4af5ac689003b">LCB_SetDeviceProperty</a>(ContiFlowPump, <a class="code" href="group__lcp__conti.html#gga2b569e9a1f7717f3d474fafe10ec6120a9617e006c423a45c129915e6fa1d25eb">PropertyRefillFlow</a>, MaxRefillFlow / 2.0);</div>
</div><!-- fragment --><p>The next parameter that you can configure is the cross flow duration. This is the time to cross-fade the flows of both syringe pumps. The smaller this value, the steeper the flow rate curve and the less time is required for the cross-flow operation to be completed. A value of 1 second is a good initial default value. If you do not want to cross fade, then use a value of 0.</p>
<div class="fragment"><div class="line">Result = <a class="code" href="group__lcb__device.html#ga7c78fb828f13b078ceb4af5ac689003b">LCB_SetDeviceProperty</a>(ContiFlowPump, <a class="code" href="group__lcp__conti.html#gga2b569e9a1f7717f3d474fafe10ec6120aff639f4a8b9bff92ff2b0938cd4626f9">PropertyCrossFlowDuration_s</a>, 1.0);</div>
</div><!-- fragment --><p>An optional parameter that you can configure is the overlap duration. This is the period of time by which the flow curves of both pumps overlap. It is a simple way of compensating for pressure drops during switching, because the second pump starts earlier to pressurize. The larger the value, the longer both pumps keep dosing simultaneously</p>
<div class="fragment"><div class="line">Result = <a class="code" href="group__lcb__device.html#ga7c78fb828f13b078ceb4af5ac689003b">LCB_SetDeviceProperty</a>(ContiFlowPump, <a class="code" href="group__lcp__conti.html#gga2b569e9a1f7717f3d474fafe10ec6120a755ca9547bec41c22d25d899be867143">PropertyOverlapDuration_s</a>, 0.0);</div>
</div><!-- fragment --><p>If you have configured all parameters, you can no query the maximum continuous flow rate. Because of the times for switching, cross flow and overlap, the maximum flow rate of the continuous flow pump is lower than the maximum flow rate of the single syringe pumps.</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> MaxContiFlowRate;</div>
<div class="line">Result = <a class="code" href="group__lcp__cfg.html#gada6609aae1a4af8d85f0a08b7e98f5ea">LCP_GetFlowRateMax</a>(ContiFlowPump, &amp;MaxContiFlowRate);</div>
</div><!-- fragment --><h2>Continuous flow initialization</h2>
<p>To start the continuous flow, the pump needs to be initialized properly. This means that at least one of the two syringe pumps should contain enough liquid for dosing so that the other pump can be filled during dosing.</p>
<div class="fragment"><div class="line">Result = <a class="code" href="group__lcp__drv.html#gafbe30da3bbf0a261787d9a74f3cf664c">LCP_ClearFault</a>(ContiFlowPump);</div>
<div class="line">Result = <a class="code" href="group__lcp__drv.html#ga028464a5a8e79afd034de02269669654">LCP_Enable</a>(ContiFlowPump);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Reference move is only required if the syringe pumps are not referenced yet</span></div>
<div class="line"><a class="code" href="group__lcb__api.html#gad29975e68b6236dc4171ddbf61ae1ee5">dev_hdl</a> SyringePump0;</div>
<div class="line">Result = <a class="code" href="group__lcp__conti.html#gabbb4da0d0d8172b13fb58ea21731dc7d">LCP_GetContiFlowSyringePump</a>(ContiFlowPump, 0, &amp;SyringePump0);</div>
<div class="line">Result = <a class="code" href="group__lcp__control.html#ga4244498259fe45378c769d7977ee852f">LCP_SyringePumpCalibrate</a>(SyringePump0);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Reference move is only required if the syringe pumps are not referenced yet</span></div>
<div class="line"><a class="code" href="group__lcb__api.html#gad29975e68b6236dc4171ddbf61ae1ee5">dev_hdl</a> SyringePump1;</div>
<div class="line">Result = <a class="code" href="group__lcp__conti.html#gabbb4da0d0d8172b13fb58ea21731dc7d">LCP_GetContiFlowSyringePump</a>(ContiFlowPump, 1, &amp;SyringePump1);</div>
<div class="line">Result = <a class="code" href="group__lcp__control.html#ga4244498259fe45378c769d7977ee852f">LCP_SyringePumpCalibrate</a>(SyringePump1);</div>
<div class="line"></div>
<div class="line"><span class="comment">// you need to wait until calibration of both syringe pumps has finished </span></div>
<div class="line"><span class="comment">// before you start the initialization</span></div>
<div class="line"></div>
<div class="line">Result = <a class="code" href="group__lcp__conti.html#gacd5b5b85e120069179fd945fa9f8ed5a">LCP_InitializeContiFlow</a>(ContiFlowPump2);</div>
</div><!-- fragment --><p>The first step is to clear all potential errors of the pump. Then you need to bring the pump into enable state - that means, both syringe pumps should be enabled. If the positioning system of both syringe pumps has not been initialized, then you need to excute a reference move via <a class="el" href="group__lcp__control.html#ga4244498259fe45378c769d7977ee852f">LCP_SyringePumpCalibrate</a> function.</p>
<p>The last step will start the initialization procedure that will fill one syringe with the configured refill flow rate. See <a class="el" href="capi_nemesys_test_8cpp-example.html">capi_nemesys_test.cpp</a> for more details.</p>
<h2>Continuous Flow Usage</h2>
<p>If you have properly configured and initialized your continuous flow pump, you can use it like any other pump. That means, you can use the normal <a class="el" href="group__lcp__control.html">pump control</a> and <a class="el" href="group__lcp__status.html">pump status</a> functions.</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> MaxContiFlowRate;</div>
<div class="line">Result = <a class="code" href="group__lcp__cfg.html#gada6609aae1a4af8d85f0a08b7e98f5ea">LCP_GetFlowRateMax</a>(ContiFlowPump1, &amp;MaxContiFlowRate);</div>
<div class="line">Result = <a class="code" href="group__lcp__control.html#gab3f8ecc6ac6b570c951df80e87ffd513">LCP_GenerateFlow</a>(ContiFlowPump1, MaxContiFlowRate);</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The continuous flow mode is meant for dispensing volumes or generating flows and works only in one direction. That means using negative flow rates or negative volumes for aspiration is not possible.</dd></dl>
<h1><a class="anchor" id="PumpAPI_ProgrammingInterface"></a>
Programming Interface - API</h1>
<p>See the <a class="el" href="group__lcp__api.html">labbCAN Pump API</a> module for a detailed reference of the pump library application programming interface </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="Page_Libraries.html">Libraries</a></li>
    <li class="footer">Generated on Wed Jun 23 2021 07:50:34 for CETONI SDK by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
